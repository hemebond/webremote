<!DOCTYPE html>
<html>
	<head>
		<title>Web Remote</title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="viewport" content="user-scalable=false">

		<script src="static/libs/jquery-1.9.1/jquery-1.9.1.min.js" type="text/javascript"></script>
		<script src="static/libs/handlebars.js" type="text/javascript"></script>
		<script src="static/libs/ember-1.0.0-rc.1.js" type="text/javascript"></script>
	</head>
	<body>
		<script type="text/x-handlebars" data-template-name="application">
			<h1>Ember Committers</h1>
			{{outlet}}
		</script>
		<script type="text/x-handlebars" data-template-name="contributors">
			{{#each person in controller}}
				{{person.login}}
			{{/each}}
		</script>
		<script type="text/x-handlebars" data-template-name="mprisapplications">
			{{#each application in controller}}
				{{application.Identity}}
			{{/each}}
		</script>

		<script type="text/javascript">
			window.App = Ember.Application.create();

			App.MprisApplication = Ember.Object.extend({
				url: null,
				name: null,
				Identity: null,
				CanQuit: null,
				CanRaise: null,
				CanSetFullscreen: null,
				player: null
			});
			App.MprisApplication.reopenClass({
				allMprisApplications: [],
				find: function() {
					$.ajax({
						url: '/',
						dataType: 'json',
						context: this,
						success: function(response) {
							response.forEach(function(application) {
								this.allMprisApplications.addObject(App.MprisApplication.create(application))
							}, this);
						}
					})
					return this.allMprisApplications;
				}
			})

			App.Contributor = Ember.Object.extend();
			App.Contributor.reopenClass({
				allContributors: [],
				find: function(){
					$.ajax({
						url: 'https://api.github.com/repos/emberjs/ember.js/contributors',
						dataType: 'jsonp',
						context: this,
						success: function(response){
							response.forEach(function(contributor){
								this.allContributors.pushObject(App.Contributor.create(contributor))
							}, this);
						}
					});
					return this.allContributors;
				}
			});

			App.ApplicationView = Ember.View.extend({
				templateName: 'application'
			});
			App.AllContributorsView = Ember.View.extend({
				templateName: 'contributors'
			});
			App.AllMprisApplicationsView = Ember.View.extend({
				templateName: 'mrpisapplications'
			});

			App.ApplicationController = Ember.Controller.extend();
			App.AllContributorsController = Ember.ArrayController.extend();
			App.AllMprisApplicationsController = Ember.ArrayController.extend();

			App.Router = Ember.Router.extend({
				root: Ember.Route.extend({
					index: Ember.Route.extend({
						route: '/',
						connectOutlets: function(router){
							router.get('applicationController').connectOutlet('allMprisApplications', App.MprisApplication.find());
						}
					})
				})
			});
			App.initialize();
		</script>
	</body>
</html>
